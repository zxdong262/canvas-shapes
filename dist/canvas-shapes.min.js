/**
 * canvas-shapes
 * @version v1.1.2 - 2015-05-30
 * @link http://html5beta.com/apps/canvas-shapes.html
 * @author ZHAO Xudong (zxdong@gmail.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(t,o,e){function r(t,o){var e={shapeCount:20,timer:100,step:3,minSize:50,maxSize:150},r=this,i=$(t);$.extend(r,{wrap:i,ctx:i[0].getContext("2d"),width:i.width(),height:i.height(),timerHandle:!1,shapes:[],methodsPool:["star"],opts:$.extend(e,o),actionCount:0})}r.prototype.start=function(t){this.buildShapes(t),this.animate()},r.prototype.animate=function(){this.loop()},r.prototype.renderShapes=function(){var t=this,o=t.shapes;t.clearShapes();for(var e=0,r=o.length;r>e;e++){var i=o[e],a=i.type;t["draw_"+a](i)}},r.prototype.loop=function(){var t=this;this.renderShapes(),this.move(),this.timerHandle=setTimeout(function(){t.loop()},this.opts.timer)},r.prototype.move=function(){for(var t=this,o=t.shapes,e=t.opts.step,r=[],i=0,a=o.length;a>i;i++){var h=o[i],e=(h.directionY/h.directionX,t.opts.step),n=h.r,l=h.x+h.directionX*e,s=h.y+h.directionY*e,p=l>h.r?l-(t.width-h.r):h.r-l,d=s>h.r?s-(t.height-h.r):h.r-s,c=0,f=0;p>0&&d>0?p>d?(s=s>h.r?t.height-h.r:n,f=s-h.y,c=f/h.directionY*h.directionX,l=h.x+c,h.directionY=-h.directionY):(l=l>h.r?t.width-h.r:n,c=l-h.x,f=c/h.directionX*h.directionY,s=h.y+f,h.directionX=-h.directionX):p>0?(l=l>h.r?t.width-h.r:n,c=l-h.x,f=c/h.directionX*h.directionY,s=h.y+f,h.directionX=-h.directionX):d>0&&(s=s>h.r?t.height-h.r:n,f=s-h.y,c=f/h.directionY*h.directionX,l=h.x+c,h.directionY=-h.directionY),h.x=l,h.y=s,r.push(h)}t.shapes=r},r.prototype.buildShapes=function(t,o){for(var e,r=this,i=t||r.opts.shapeCount,a=o||r.methodsPool,h=a.length,n=0;i>n;n++)e=Math.floor(Math.random()*h),r.shapes.push(r.buildShape(a[e]))},r.prototype.buildShape=function(t){return this["build_shape_"+t]()},r.prototype.popShape=function(t){var o=this.shapes.length,e=t>o?o:t;e=o-e,this.shapes=this.shapes.slice(0,e),this.opts.shapeCount=this.opts.shapeCount-t},r.prototype.pushShape=function(t,o){var e=this,r=o||e.methodsPool,i=r.length,a=Math.floor(Math.random()*i);e.shapes.push($.extend(e.buildShape(r[a]),t)),this.opts.shapeCount++},r.prototype.stop=function(){clearTimeout(this.timerHandle),this.clearShapes()},r.prototype.clearShapes=function(){this.ctx.clearRect(0,0,this.width,this.height)},r.prototype.build_shape_bubble=function(){var t=this,o=t.opts,e=Math.floor(Math.random()*(o.maxSize-o.minSize))+o.minSize,r=2*e,i=t.width>r?t.width:r+1,a=t.height>r?t.height:r+1,h=e+Math.floor(Math.random()*(i-r)),n=e+Math.floor(Math.random()*(a-r)),l=(Math.floor(7*Math.random())-3)/3,s=(Math.floor(7*Math.random())-3)/3,p=["rgba(156,183,52,.25)","rgba(227,163,26,.25)","rgba(217,84,56,.25)","rgba(4,80,150,.25)","rgba(122,24,105,.25)"],d=p.length,c=Math.floor(Math.random()*d),f={x:h,y:n,r:e,directionX:l,directionY:s,type:"bubble",fillStyle:p[c]};return f},r.prototype.draw_bubble=function(t){var o=this.ctx;o.beginPath(),o.fillStyle=t.fillStyle,o.arc(t.x,t.y,t.r,0,2*Math.PI,!0),o.fill(),o.closePath()},r.prototype.draw_balloon=function(t){var o=this.ctx;o.beginPath(),o.fillStyle=t.fillStyle,o.arc(t.x,t.y,t.r,0,2*Math.PI,!0),o.fill(),o.closePath(),o.beginPath(),o.moveTo(this.width/2,this.height-20),o.lineTo(t.x,t.y),o.strokeStyle=t.strokeStyle,o.stroke(),o.closePath()},r.prototype.build_shape_balloon=function(){var t=this,o=t.opts,e=Math.floor(Math.random()*(o.maxSize-o.minSize))+o.minSize,r=2*e,i=t.width>r?t.width:r+1,a=t.height>r?t.height:r+1,h=e+Math.floor(Math.random()*(i-r)),n=e+Math.floor(Math.random()*(a-r)),l=(Math.floor(7*Math.random())-3)/3,s=(Math.floor(7*Math.random())-3)/3,p=["rgba(156,183,52,.25)","rgba(227,163,26,.25)","rgba(217,84,56,.25)","rgba(4,80,150,.25)","rgba(122,24,105,.25)"],d=p.length,c=Math.floor(Math.random()*d),f={x:h,y:n,r:e,directionX:l,directionY:s,type:"balloon",strokeStyle:p[c],fillStyle:p[c]};return f},r.prototype.draw_light=function(t){var o=this.ctx;o.beginPath(),o.moveTo(20,20),o.lineTo(t.x,t.y),o.strokeStyle=t.strokeStyle,o.stroke(),o.closePath()},r.prototype.build_shape_light=function(){var t=this,o=t.opts,e=Math.floor(Math.random()*(o.maxSize-o.minSize))+o.minSize,r=2*e,i=t.width>r?t.width:r+1,a=t.height>r?t.height:r+1,h=e+Math.floor(Math.random()*(i-r)),n=e+Math.floor(Math.random()*(a-r)),l=(Math.floor(7*Math.random())-3)/3,s=(Math.floor(7*Math.random())-3)/3,p=["rgba(156,183,52,.25)","rgba(227,163,26,.25)","rgba(217,84,56,.25)","rgba(4,80,150,.25)","rgba(122,24,105,.25)"],d=p.length,c=Math.floor(Math.random()*d),f={x:h,y:n,r:e,directionX:l,directionY:s,type:"light",strokeStyle:p[c]};return f},r.prototype.build_shape_heart=function(){var t=this,o=t.opts,e=Math.floor(Math.random()*(o.maxSize-o.minSize))+o.minSize,r=2*e,i=t.width>r?t.width:r+1,a=t.height>r?t.height:r+1,h=e+Math.floor(Math.random()*(i-r)),n=e+Math.floor(Math.random()*(a-r)),l=2*Math.random()-1,s=2*Math.random()-1,p={x:h,y:n,r:e,directionX:l,directionY:s,type:"heart",fillStyle:"rgba(207,13,31,.25)"};return p},r.prototype.draw_heart=function(t){var o=this,e=o.ctx,r=t.r/75,i=t.x,a=t.y,h=i-t.r,n=a-t.r;e.beginPath(),e.fillStyle=t.fillStyle,e.moveTo(h+75*r,n+40*r),e.bezierCurveTo(h+75*r,n+37*r,h+70*r,n+25*r,h+50*r,n+25*r),e.bezierCurveTo(h+20*r,n+25*r,h+20*r,n+62.5*r,h+20*r,n+62.5*r),e.bezierCurveTo(h+20*r,n+80*r,h+40*r,n+102*r,h+75*r,n+120*r),e.bezierCurveTo(h+110*r,n+102*r,h+130*r,n+80*r,h+130*r,n+62.5*r),e.bezierCurveTo(h+130*r,n+62.5*r,h+130*r,n+25*r,h+100*r,n+25*r),e.bezierCurveTo(h+85*r,n+25*r,h+75*r,n+37*r,h+75*r,n+40*r),e.fill(),e.closePath()},r.prototype.build_shape_star=function(){var t=this,o=t.opts,e=Math.floor(Math.random()*(o.maxSize-o.minSize))+o.minSize,r=2*e,i=t.width>r?t.width:r+1,a=t.height>r?t.height:r+1,h=e+Math.floor(Math.random()*(i-r)),n=e+Math.floor(Math.random()*(a-r)),l=2*Math.random()-1,s=2*Math.random()-1,p=5+Math.floor(5*Math.random()),d=["rgba(156,183,52,.25)","rgba(227,163,26,.25)","rgba(217,84,56,.25)","rgba(4,80,150,.25)","rgba(122,24,105,.25)"],c=d.length,f=Math.floor(Math.random()*c),y={x:h,y:n,r:e,outerR:e,innerR:e/2,spike:p,directionX:l,directionY:s,type:"star"};return 5===p?y.fillStyle="rgba(207,13,31,.25)":y.strokeStyle=d[f],y},r.prototype.draw_star=function(t){var o,e,r=Math.PI/2*3,a=t.x,h=t.y,n=t.spike,l=Math.PI/n,s=this,p=s.ctx,d=t.outerR,c=t.innerR;for(t.strokeStyle?p.strokeStyle=t.strokeStyle:p.fillStyle=t.fillStyle,p.beginPath(),p.moveTo(a,h-d),i=0;i<n;i++)o=a+Math.cos(r)*d,e=h+Math.sin(r)*d,p.lineTo(o,e),r+=l,o=a+Math.cos(r)*c,e=h+Math.sin(r)*c,p.lineTo(o,e),r+=l;p.lineTo(a,h-d),t.strokeStyle?p.stroke():p.fill(),p.closePath()},r.prototype.moveTo=function(t){for(var o=this,e=o.shapes,r=t,i=[],a=0,h=e.length;h>a;a++){var n=e[a],l=r[a],s=(n.x+l.x)/2,p=(n.y+l.y)/2;i.push($.extend(n,{x:s,y:p}))}o.shapes=i},r.prototype.buildPosArrayFromText=function(t,o){{var e=this,r=e.ctx,i=e.width,a=e.height,h=t,n=o||{},l=(n.shapeSize||20,n.scanDistance||5),s=n.fontSize||200,p=n.fontFamily||"sans-serif";n.top||(a-s)/2}r.textAlign=n.textAlign||"start",r.textBaseline=n.textBaseline||"top",e.clearShapes(),r.font=s+"px "+p,r.fillStyle="red",r.fillText(h,20,20);for(var d=r.getImageData(0,0,i,a),c=d.data,f=[],y=(Math.floor(i/l)*Math.floor(a/l),0);i>y;y+=l)for(var m=0;a>m;m+=l){var u=m*i+y,M=c[4*u];M&&f.push({x:y,y:m})}return e.clearShapes(),f},t.Shapes=r}(window,document);