/**
 * canvas-shapes
 * @version v0.0.1 - 2015-05-13
 * @link http://html5beta.com/apps/canvas-shapes.html
 * @author ZHAO Xudong (zxdong@gmail.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(t){function e(t,e){var o={shapeCount:20,timer:100,step:3,minSize:50,maxSize:150},i=this,r=$(t);$.extend(i,{wrap:r,ctx:r[0].getContext("2d"),width:r.width(),height:r.height(),timerHandle:!1,shapes:[],methodsPool:["star"],opts:$.extend(o,e),actionCount:0})}e.prototype.start=function(t){this.buildShapes(t),this.animate()},e.prototype.animate=function(){this.loop()},e.prototype.renderShapes=function(){var t=this,e=t.shapes;t.clearShapes();for(var o=0,i=e.length;i>o;o++){var r=e[o],h=r.type;t["draw_"+h](r)}},e.prototype.loop=function(){var t=this;this.renderShapes(),this.move(),this.timerHandle=setTimeout(function(){t.loop()},this.opts.timer)},e.prototype.move=function(){for(var t=this,e=t.shapes,o=t.opts.step,i=[],r=0,h=e.length;h>r;r++){var a=e[r],o=(a.directionY/a.directionX,t.opts.step),n=a.r,s=a.x+a.directionX*o,l=a.y+a.directionY*o,p=s>a.r?s-(t.width-a.r):a.r-s,d=l>a.r?l-(t.height-a.r):a.r-l,c=0,u=0;p>0&&d>0?p>d?(l=l>a.r?t.height-a.r:n,u=l-a.y,c=u/a.directionY*a.directionX,s=a.x+c,a.directionY=-a.directionY):(s=s>a.r?t.width-a.r:n,c=s-a.x,u=c/a.directionX*a.directionY,l=a.y+u,a.directionX=-a.directionX):p>0?(s=s>a.r?t.width-a.r:n,c=s-a.x,u=c/a.directionX*a.directionY,l=a.y+u,a.directionX=-a.directionX):d>0&&(l=l>a.r?t.height-a.r:n,u=l-a.y,c=u/a.directionY*a.directionX,s=a.x+c,a.directionY=-a.directionY),a.x=s,a.y=l,i.push(a)}t.shapes=i},e.prototype.buildShapes=function(t,e){for(var o,i=this,r=t||i.opts.shapeCount,h=e||i.methodsPool,a=h.length,n=0;r>n;n++)o=Math.floor(Math.random()*a),i.shapes.push(i.buildShape(h[o]))},e.prototype.buildShape=function(t){return this["build_shape_"+t]()},e.prototype.build_shape_bubble=function(){var t=this,e=t.opts,o=Math.floor(Math.random()*(e.maxSize-e.minSize))+e.minSize,i=2*o,r=t.width>i?t.width:i+1,h=t.height>i?t.height:i+1,a=o+Math.floor(Math.random()*(r-i)),n=o+Math.floor(Math.random()*(h-i)),s=(Math.floor(7*Math.random())-3)/3,l=(Math.floor(7*Math.random())-3)/3,p=["rgba(156,183,52,.25)","rgba(227,163,26,.25)","rgba(217,84,56,.25)","rgba(4,80,150,.25)","rgba(122,24,105,.25)"],d=p.length,c=Math.floor(Math.random()*d),u={x:a,y:n,r:o,directionX:s,directionY:l,type:"bubble",fillStyle:p[c]};return u},e.prototype.build_shape_heart=function(){var t=this,e=t.opts,o=Math.floor(Math.random()*(e.maxSize-e.minSize))+e.minSize,i=2*o,r=t.width>i?t.width:i+1,h=t.height>i?t.height:i+1,a=o+Math.floor(Math.random()*(r-i)),n=o+Math.floor(Math.random()*(h-i)),s=2*Math.random()-1,l=2*Math.random()-1,p={x:a,y:n,r:o,directionX:s,directionY:l,type:"heart",fillStyle:"rgba(207,13,31,.25)"};return p},e.prototype.build_shape_star=function(){var t=this,e=t.opts,o=Math.floor(Math.random()*(e.maxSize-e.minSize))+e.minSize,i=2*o,r=t.width>i?t.width:i+1,h=t.height>i?t.height:i+1,a=o+Math.floor(Math.random()*(r-i)),n=o+Math.floor(Math.random()*(h-i)),s=2*Math.random()-1,l=2*Math.random()-1,p=5+Math.floor(5*Math.random()),d=["rgba(156,183,52,.25)","rgba(227,163,26,.25)","rgba(217,84,56,.25)","rgba(4,80,150,.25)","rgba(122,24,105,.25)"],c=d.length,u=Math.floor(Math.random()*c),f={x:a,y:n,r:o,outerR:o,innerR:o/2,spike:p,directionX:s,directionY:l,type:"star"};return 5===p?f.fillStyle="rgba(207,13,31,.25)":f.strokeStyle=d[u],f},e.prototype.popShape=function(t){var e=this.shapes.length,o=t>e?e:t;o=e-o,this.shapes=this.shapes.slice(0,o)},e.prototype.pushShape=function(t,e){var o=this,i=e||o.methodsPool,r=i.length,h=Math.floor(Math.random()*r);o.shapes.push($.extend(o.buildShape(i[h]),t))},e.prototype.stop=function(){clearTimeout(this.timerHandle),this.clearShapes()},e.prototype.clearShapes=function(){this.ctx.clearRect(0,0,this.width,this.height)},e.prototype.draw_bubble=function(t){var e=this.ctx;e.beginPath(),e.fillStyle=t.fillStyle,e.arc(t.x,t.y,t.r,0,2*Math.PI,!0),e.fill(),e.closePath()},e.prototype.draw_heart=function(t){var e=this,o=e.ctx,i=t.r/75,r=t.x,h=t.y,a=r-t.r,n=h-t.r;o.beginPath(),o.fillStyle=t.fillStyle,o.moveTo(a+75*i,n+40*i),o.bezierCurveTo(a+75*i,n+37*i,a+70*i,n+25*i,a+50*i,n+25*i),o.bezierCurveTo(a+20*i,n+25*i,a+20*i,n+62.5*i,a+20*i,n+62.5*i),o.bezierCurveTo(a+20*i,n+80*i,a+40*i,n+102*i,a+75*i,n+120*i),o.bezierCurveTo(a+110*i,n+102*i,a+130*i,n+80*i,a+130*i,n+62.5*i),o.bezierCurveTo(a+130*i,n+62.5*i,a+130*i,n+25*i,a+100*i,n+25*i),o.bezierCurveTo(a+85*i,n+25*i,a+75*i,n+37*i,a+75*i,n+40*i),o.fill(),o.closePath()},e.prototype.draw_star=function(t){var e,o,r=Math.PI/2*3,h=t.x,a=t.y,n=t.spike,s=Math.PI/n,l=this,p=l.ctx,d=t.outerR,c=t.innerR;for(t.strokeStyle?p.strokeStyle=t.strokeStyle:p.fillStyle=t.fillStyle,p.beginPath(),p.moveTo(h,a-d),i=0;i<n;i++)e=h+Math.cos(r)*d,o=a+Math.sin(r)*d,p.lineTo(e,o),r+=s,e=h+Math.cos(r)*c,o=a+Math.sin(r)*c,p.lineTo(e,o),r+=s;p.lineTo(h,a-d),t.strokeStyle?p.stroke():p.fill(),p.closePath()},t.Shapes=e}(window,document);