/**
 * canvas-shapes
 * @version v1.0.1 - 2015-05-14
 * @link http://html5beta.com/apps/canvas-shapes.html
 * @author ZHAO Xudong (zxdong@gmail.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(t){function o(t,o){var e={shapeCount:20,timer:100,step:3,minSize:50,maxSize:150},r=this,i=$(t);$.extend(r,{wrap:i,ctx:i[0].getContext("2d"),width:i.width(),height:i.height(),timerHandle:!1,shapes:[],methodsPool:["star"],opts:$.extend(e,o),actionCount:0})}o.prototype.start=function(t){this.buildShapes(t),this.animate()},o.prototype.animate=function(){this.loop()},o.prototype.renderShapes=function(){var t=this,o=t.shapes;t.clearShapes();for(var e=0,r=o.length;r>e;e++){var i=o[e],h=i.type;t["draw_"+h](i)}},o.prototype.loop=function(){var t=this;this.renderShapes(),this.move(),this.timerHandle=setTimeout(function(){t.loop()},this.opts.timer)},o.prototype.move=function(){for(var t=this,o=t.shapes,e=t.opts.step,r=[],i=0,h=o.length;h>i;i++){var a=o[i],e=(a.directionY/a.directionX,t.opts.step),n=a.r,s=a.x+a.directionX*e,l=a.y+a.directionY*e,p=s>a.r?s-(t.width-a.r):a.r-s,d=l>a.r?l-(t.height-a.r):a.r-l,c=0,u=0;p>0&&d>0?p>d?(l=l>a.r?t.height-a.r:n,u=l-a.y,c=u/a.directionY*a.directionX,s=a.x+c,a.directionY=-a.directionY):(s=s>a.r?t.width-a.r:n,c=s-a.x,u=c/a.directionX*a.directionY,l=a.y+u,a.directionX=-a.directionX):p>0?(s=s>a.r?t.width-a.r:n,c=s-a.x,u=c/a.directionX*a.directionY,l=a.y+u,a.directionX=-a.directionX):d>0&&(l=l>a.r?t.height-a.r:n,u=l-a.y,c=u/a.directionY*a.directionX,s=a.x+c,a.directionY=-a.directionY),a.x=s,a.y=l,r.push(a)}t.shapes=r},o.prototype.buildShapes=function(t,o){for(var e,r=this,i=t||r.opts.shapeCount,h=o||r.methodsPool,a=h.length,n=0;i>n;n++)e=Math.floor(Math.random()*a),r.shapes.push(r.buildShape(h[e]))},o.prototype.buildShape=function(t){return this["build_shape_"+t]()},o.prototype.popShape=function(t){var o=this.shapes.length,e=t>o?o:t;e=o-e,this.shapes=this.shapes.slice(0,e),this.opts.shapeCount=this.opts.shapeCount-t},o.prototype.pushShape=function(t,o){var e=this,r=o||e.methodsPool,i=r.length,h=Math.floor(Math.random()*i);e.shapes.push($.extend(e.buildShape(r[h]),t)),this.opts.shapeCount++},o.prototype.stop=function(){clearTimeout(this.timerHandle),this.clearShapes()},o.prototype.clearShapes=function(){this.ctx.clearRect(0,0,this.width,this.height)},o.prototype.build_shape_bubble=function(){var t=this,o=t.opts,e=Math.floor(Math.random()*(o.maxSize-o.minSize))+o.minSize,r=2*e,i=t.width>r?t.width:r+1,h=t.height>r?t.height:r+1,a=e+Math.floor(Math.random()*(i-r)),n=e+Math.floor(Math.random()*(h-r)),s=(Math.floor(7*Math.random())-3)/3,l=(Math.floor(7*Math.random())-3)/3,p=["rgba(156,183,52,.25)","rgba(227,163,26,.25)","rgba(217,84,56,.25)","rgba(4,80,150,.25)","rgba(122,24,105,.25)"],d=p.length,c=Math.floor(Math.random()*d),u={x:a,y:n,r:e,directionX:s,directionY:l,type:"bubble",strokeStyle:p[c]};return u},o.prototype.draw_bubble=function(t){var o=this.ctx;o.beginPath(),o.fillStyle=t.fillStyle,o.arc(t.x,t.y,t.r,0,2*Math.PI,!0),o.fill(),o.closePath()},o.prototype.draw_light=function(t){var o=this.ctx;o.beginPath(),o.moveTo(10,10),o.lineTo(t.x,t.y),o.strokeStyle=t.strokeStyle,o.stroke(),o.closePath()},o.prototype.build_shape_light=function(){var t=this,o=t.opts,e=Math.floor(Math.random()*(o.maxSize-o.minSize))+o.minSize,r=2*e,i=t.width>r?t.width:r+1,h=t.height>r?t.height:r+1,a=e+Math.floor(Math.random()*(i-r)),n=e+Math.floor(Math.random()*(h-r)),s=(Math.floor(7*Math.random())-3)/3,l=(Math.floor(7*Math.random())-3)/3,p=["rgba(156,183,52,.25)","rgba(227,163,26,.25)","rgba(217,84,56,.25)","rgba(4,80,150,.25)","rgba(122,24,105,.25)"],d=p.length,c=Math.floor(Math.random()*d),u={x:a,y:n,r:e,directionX:s,directionY:l,type:"light",strokeStyle:p[c]};return u},o.prototype.build_shape_heart=function(){var t=this,o=t.opts,e=Math.floor(Math.random()*(o.maxSize-o.minSize))+o.minSize,r=2*e,i=t.width>r?t.width:r+1,h=t.height>r?t.height:r+1,a=e+Math.floor(Math.random()*(i-r)),n=e+Math.floor(Math.random()*(h-r)),s=2*Math.random()-1,l=2*Math.random()-1,p={x:a,y:n,r:e,directionX:s,directionY:l,type:"heart",fillStyle:"rgba(207,13,31,.25)"};return p},o.prototype.draw_heart=function(t){var o=this,e=o.ctx,r=t.r/75,i=t.x,h=t.y,a=i-t.r,n=h-t.r;e.beginPath(),e.fillStyle=t.fillStyle,e.moveTo(a+75*r,n+40*r),e.bezierCurveTo(a+75*r,n+37*r,a+70*r,n+25*r,a+50*r,n+25*r),e.bezierCurveTo(a+20*r,n+25*r,a+20*r,n+62.5*r,a+20*r,n+62.5*r),e.bezierCurveTo(a+20*r,n+80*r,a+40*r,n+102*r,a+75*r,n+120*r),e.bezierCurveTo(a+110*r,n+102*r,a+130*r,n+80*r,a+130*r,n+62.5*r),e.bezierCurveTo(a+130*r,n+62.5*r,a+130*r,n+25*r,a+100*r,n+25*r),e.bezierCurveTo(a+85*r,n+25*r,a+75*r,n+37*r,a+75*r,n+40*r),e.fill(),e.closePath()},o.prototype.build_shape_star=function(){var t=this,o=t.opts,e=Math.floor(Math.random()*(o.maxSize-o.minSize))+o.minSize,r=2*e,i=t.width>r?t.width:r+1,h=t.height>r?t.height:r+1,a=e+Math.floor(Math.random()*(i-r)),n=e+Math.floor(Math.random()*(h-r)),s=2*Math.random()-1,l=2*Math.random()-1,p=5+Math.floor(5*Math.random()),d=["rgba(156,183,52,.25)","rgba(227,163,26,.25)","rgba(217,84,56,.25)","rgba(4,80,150,.25)","rgba(122,24,105,.25)"],c=d.length,u=Math.floor(Math.random()*c),f={x:a,y:n,r:e,outerR:e,innerR:e/2,spike:p,directionX:s,directionY:l,type:"star"};return 5===p?f.fillStyle="rgba(207,13,31,.25)":f.strokeStyle=d[u],f},o.prototype.draw_star=function(t){var o,e,r=Math.PI/2*3,h=t.x,a=t.y,n=t.spike,s=Math.PI/n,l=this,p=l.ctx,d=t.outerR,c=t.innerR;for(t.strokeStyle?p.strokeStyle=t.strokeStyle:p.fillStyle=t.fillStyle,p.beginPath(),p.moveTo(h,a-d),i=0;i<n;i++)o=h+Math.cos(r)*d,e=a+Math.sin(r)*d,p.lineTo(o,e),r+=s,o=h+Math.cos(r)*c,e=a+Math.sin(r)*c,p.lineTo(o,e),r+=s;p.lineTo(h,a-d),t.strokeStyle?p.stroke():p.fill(),p.closePath()},t.Shapes=o}(window,document);