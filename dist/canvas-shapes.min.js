/**
 * canvas-shapes
 * @version v1.1.5 - 2015-05-31
 * @link http://html5beta.com/apps/canvas-shapes.html
 * @author ZHAO Xudong (zxdong@gmail.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(t,e,o){function r(t,e){var o={shapeCount:20,timer:100,step:3,minSize:50,maxSize:150},r=this,i=$(t);$.extend(r,{wrap:i,ctx:i[0].getContext("2d"),width:i.width(),height:i.height(),timerHandle:!1,shapes:[],methodsPool:["star"],opts:$.extend(o,e),actionCount:0})}r.prototype.start=function(t){this.buildShapes(t),this.animate()},r.prototype.animate=function(){this.loop()},r.prototype.renderShapes=function(){var t=this,e=t.shapes;t.clearShapes();for(var o=0,r=e.length;r>o;o++){var i=e[o],a=i.type;t["draw_"+a](i)}},r.prototype.loop=function(){var t=this;this.renderShapes(),this.move(),this.timerHandle=setTimeout(function(){t.loop()},this.opts.timer)},r.prototype.move=function(){for(var t=this,e=t.shapes,o=t.opts.step,r=[],i=0,a=e.length;a>i;i++){var h=e[i],o=(h.directionY/h.directionX,t.opts.step),n=h.r,l=h.x+h.directionX*o,s=h.y+h.directionY*o,p=l>h.r?l-(t.width-h.r):h.r-l,d=s>h.r?s-(t.height-h.r):h.r-s,c=0,f=0;p>0&&d>0?p>d?(s=s>h.r?t.height-h.r:n,f=s-h.y,c=f/h.directionY*h.directionX,l=h.x+c,h.directionY=-h.directionY):(l=l>h.r?t.width-h.r:n,c=l-h.x,f=c/h.directionX*h.directionY,s=h.y+f,h.directionX=-h.directionX):p>0?(l=l>h.r?t.width-h.r:n,c=l-h.x,f=c/h.directionX*h.directionY,s=h.y+f,h.directionX=-h.directionX):d>0&&(s=s>h.r?t.height-h.r:n,f=s-h.y,c=f/h.directionY*h.directionX,l=h.x+c,h.directionY=-h.directionY),h.x=l,h.y=s,r.push(h)}t.shapes=r},r.prototype.buildShapes=function(t,e){for(var o,r=this,i=t||r.opts.shapeCount,a=e||r.methodsPool,h=a.length,n=0;i>n;n++)o=Math.floor(Math.random()*h),r.shapes.push(r.buildShape(a[o]))},r.prototype.buildShape=function(t){return this["build_shape_"+t]()},r.prototype.popShape=function(t){var e=this.shapes.length,o=t>e?e:t;o=e-o,this.shapes=this.shapes.slice(0,o),this.opts.shapeCount=this.opts.shapeCount-t},r.prototype.pushShape=function(t,e){var o=this,r=e||o.methodsPool,i=r.length,a=Math.floor(Math.random()*i);o.shapes.push($.extend(o.buildShape(r[a]),t)),this.opts.shapeCount++},r.prototype.stop=function(){clearTimeout(this.timerHandle),this.clearShapes()},r.prototype.clearShapes=function(){this.ctx.clearRect(0,0,this.width,this.height)},r.prototype.build_shape_bubble=function(){var t=this,e=t.opts,o=Math.floor(Math.random()*(e.maxSize-e.minSize))+e.minSize,r=2*o,i=t.width>r?t.width:r+1,a=t.height>r?t.height:r+1,h=o+Math.floor(Math.random()*(i-r)),n=o+Math.floor(Math.random()*(a-r)),l=(Math.floor(7*Math.random())-3)/3,s=(Math.floor(7*Math.random())-3)/3,p=["rgba(156,183,52,.25)","rgba(227,163,26,.25)","rgba(217,84,56,.25)","rgba(4,80,150,.25)","rgba(122,24,105,.25)"],d=p.length,c=Math.floor(Math.random()*d),f={x:h,y:n,r:o,directionX:l,directionY:s,type:"bubble",fillStyle:p[c]};return f},r.prototype.draw_bubble=function(t){var e=this.ctx;e.beginPath(),e.fillStyle=t.fillStyle,e.arc(t.x,t.y,t.r,0,2*Math.PI,!0),e.fill(),e.closePath()},r.prototype.draw_balloon=function(t){var e=this.ctx;e.beginPath(),e.fillStyle=t.fillStyle,e.arc(t.x,t.y,t.r,0,2*Math.PI,!0),e.fill(),e.closePath(),e.beginPath(),e.moveTo(this.width/2,this.height-20),e.lineTo(t.x,t.y),e.strokeStyle=t.strokeStyle,e.stroke(),e.closePath()},r.prototype.build_shape_balloon=function(){var t=this,e=t.opts,o=Math.floor(Math.random()*(e.maxSize-e.minSize))+e.minSize,r=2*o,i=t.width>r?t.width:r+1,a=t.height>r?t.height:r+1,h=o+Math.floor(Math.random()*(i-r)),n=o+Math.floor(Math.random()*(a-r)),l=(Math.floor(7*Math.random())-3)/3,s=(Math.floor(7*Math.random())-3)/3,p=["rgba(156,183,52,.25)","rgba(227,163,26,.25)","rgba(217,84,56,.25)","rgba(4,80,150,.25)","rgba(122,24,105,.25)"],d=p.length,c=Math.floor(Math.random()*d),f={x:h,y:n,r:o,directionX:l,directionY:s,type:"balloon",strokeStyle:p[c],fillStyle:p[c]};return f},r.prototype.draw_light=function(t){var e=this.ctx;e.beginPath(),e.moveTo(20,20),e.lineTo(t.x,t.y),e.strokeStyle=t.strokeStyle,e.stroke(),e.closePath()},r.prototype.build_shape_light=function(){var t=this,e=t.opts,o=Math.floor(Math.random()*(e.maxSize-e.minSize))+e.minSize,r=2*o,i=t.width>r?t.width:r+1,a=t.height>r?t.height:r+1,h=o+Math.floor(Math.random()*(i-r)),n=o+Math.floor(Math.random()*(a-r)),l=(Math.floor(7*Math.random())-3)/3,s=(Math.floor(7*Math.random())-3)/3,p=["rgba(156,183,52,.25)","rgba(227,163,26,.25)","rgba(217,84,56,.25)","rgba(4,80,150,.25)","rgba(122,24,105,.25)"],d=p.length,c=Math.floor(Math.random()*d),f={x:h,y:n,r:o,directionX:l,directionY:s,type:"light",strokeStyle:p[c]};return f},r.prototype.build_shape_heart=function(){var t=this,e=t.opts,o=Math.floor(Math.random()*(e.maxSize-e.minSize))+e.minSize,r=2*o,i=t.width>r?t.width:r+1,a=t.height>r?t.height:r+1,h=o+Math.floor(Math.random()*(i-r)),n=o+Math.floor(Math.random()*(a-r)),l=2*Math.random()-1,s=2*Math.random()-1,p={x:h,y:n,r:o,directionX:l,directionY:s,type:"heart",fillStyle:"rgba(207,13,31,.25)"};return p},r.prototype.draw_heart=function(t){var e=this,o=e.ctx,r=t.r/75,i=t.x,a=t.y,h=i-t.r,n=a-t.r;o.beginPath(),o.fillStyle=t.fillStyle,o.moveTo(h+75*r,n+40*r),o.bezierCurveTo(h+75*r,n+37*r,h+70*r,n+25*r,h+50*r,n+25*r),o.bezierCurveTo(h+20*r,n+25*r,h+20*r,n+62.5*r,h+20*r,n+62.5*r),o.bezierCurveTo(h+20*r,n+80*r,h+40*r,n+102*r,h+75*r,n+120*r),o.bezierCurveTo(h+110*r,n+102*r,h+130*r,n+80*r,h+130*r,n+62.5*r),o.bezierCurveTo(h+130*r,n+62.5*r,h+130*r,n+25*r,h+100*r,n+25*r),o.bezierCurveTo(h+85*r,n+25*r,h+75*r,n+37*r,h+75*r,n+40*r),o.fill(),o.closePath()},r.prototype.build_shape_star=function(){var t=this,e=t.opts,o=Math.floor(Math.random()*(e.maxSize-e.minSize))+e.minSize,r=2*o,i=t.width>r?t.width:r+1,a=t.height>r?t.height:r+1,h=o+Math.floor(Math.random()*(i-r)),n=o+Math.floor(Math.random()*(a-r)),l=2*Math.random()-1,s=2*Math.random()-1,p=5+Math.floor(5*Math.random()),d=["rgba(156,183,52,.25)","rgba(227,163,26,.25)","rgba(217,84,56,.25)","rgba(4,80,150,.25)","rgba(122,24,105,.25)"],c=d.length,f=Math.floor(Math.random()*c),y={x:h,y:n,r:o,outerR:o,innerR:o/2,spike:p,directionX:l,directionY:s,type:"star"};return 5===p?y.fillStyle="rgba(207,13,31,.25)":y.strokeStyle=d[f],y},r.prototype.draw_star=function(t){var e,o,r=Math.PI/2*3,a=t.x,h=t.y,n=t.spike,l=Math.PI/n,s=this,p=s.ctx,d=t.outerR,c=t.innerR;for(t.strokeStyle?p.strokeStyle=t.strokeStyle:p.fillStyle=t.fillStyle,p.beginPath(),p.moveTo(a,h-d),i=0;i<n;i++)e=a+Math.cos(r)*d,o=h+Math.sin(r)*d,p.lineTo(e,o),r+=l,e=a+Math.cos(r)*c,o=h+Math.sin(r)*c,p.lineTo(e,o),r+=l;p.lineTo(a,h-d),t.strokeStyle?p.stroke():p.fill(),p.closePath()},r.prototype.moveTo=function(t,e){var o=this,r=o.shapes,i=t,a=[],h=e||{},n=h.speed;n=!n||n>1||0>=n?.5:n;for(var l=0,s=r.length;s>l;l++){var p=r[l],d=i[l],c=(p.x+d.x)*n,f=(p.y+d.y)*n;a.push($.extend(p,{x:c,y:f}))}o.shapes=a},r.prototype.buildPosArrayFromText=function(t,e){var o=this,r=o.ctx,i=o.width,a=o.height,h=t,n=e||{},l=(n.shapeSize||20,n.scanDistance||5),s=n.fontSize||200,p=n.fontFamily||"sans-serif",d=n.top||20;r.textAlign=n.textAlign||"start",r.textBaseline=n.textBaseline||"top",o.clearShapes(),r.font=s+"px "+p,r.fillStyle="red",r.fillText(h,20,d);for(var c=r.getImageData(0,0,i,a),f=c.data,y=[],m=(Math.floor(i/l)*Math.floor(a/l),0);i>m;m+=l)for(var u=0;a>u;u+=l){var M=u*i+m,g=f[4*M];g&&y.push({x:m,y:u})}return o.clearShapes(),y},t.Shapes=r}(window,document);